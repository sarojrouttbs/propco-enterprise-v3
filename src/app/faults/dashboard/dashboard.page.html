<!-- <div class="dashboard-container"> -->
<ion-content id="fault-list">
  <ion-grid>
    <ion-row>
      <ion-col class="ion-text-left">
        <h1>Fault Dashboard</h1>
      </ion-col>
      <ion-col class="ion-text-right">
        <ion-button class="no-margin" (click)="addFault()" fill="solid" color="success">Add Fault</ion-button>
      </ion-col>
    </ion-row>

    <ion-row style="margin-bottom: 10px">
        <h5 style="color: gray;" class="ion-text-left">Filter by type or status</h5>
    </ion-row>

    <form [formGroup]="filterForm">
      <ion-row>
        <ion-col size="12" size-md
          [ngClass]="filterForm.get('repairCheckbox').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="medium" mode="ios" formControlName="repairCheckbox" (ionChange)="checkboxClick()">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">Active Repairs</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('newRepairs').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="medium" mode="ios" formControlName="newRepairs" (ionChange)="checkboxClick()">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">New Repairs</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('emergency').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="danger" mode="ios" formControlName="emergency" (ionChange)="checkboxClick()" style="--border-color:var(--background-checked);">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">Emergency</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('urgent').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="warning" mode="ios" formControlName="urgent" (ionChange)="checkboxClick()" style="--border-color:var(--background-checked);">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">Urgent</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('nonUrgent').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="success" mode="ios" formControlName="nonUrgent" (ionChange)="checkboxClick()" style="--border-color:var(--background-checked);">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">Non urgent</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('assessment').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="medium" mode="ios" formControlName="assessment" (ionChange)="checkboxClick()">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">In Assessment</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('automation').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="medium" mode="ios" formControlName="automation" (ionChange)="checkboxClick()">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">In Automation</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('invoice').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="medium" mode="ios" formControlName="invoice" (ionChange)="checkboxClick()">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">Invoice</div>
        </ion-col>
        <ion-col size="12" size-md [ngClass]="filterForm.get('escalation').value?'filter-grid-active':'filter-grid'">
          <div>
            <ion-checkbox color="medium" mode="ios" formControlName="escalation" (ionChange)="checkboxClick()">
            </ion-checkbox>
          </div>
          <!-- <div class="filter-grid-count">269</div> -->
          <div class="filter-grid-text">Escalation</div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size=15>
          <ion-item>
            <ion-label position="floating">From</ion-label>
            <ion-datetime dateFormat="MM/DD/YYYY" displayFormat="DD MMM YYYY" style="padding-bottom: 0px;"
              formControlName="fromDate" (ionChange)="checkboxClick()">
            </ion-datetime>
            <ion-icon name="calendar" slot="start" class="datetime-icon"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size=15>
          <ion-item>
            <ion-label position="floating">To</ion-label>
            <ion-datetime dateFormat="MM/DD/YYYY" displayFormat="DD MMM YYYY" style="padding-bottom: 0px;"
              formControlName="toDate" (ionChange)="checkboxClick()">
            </ion-datetime>
            <ion-icon name="calendar" slot="start" class="datetime-icon"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size=15>
          <ion-item>
            <ion-label position="floating">More Filters</ion-label>
            <ion-select interface="popover" (ionChange)="onFiletrChange($event)" formControlName="filterType"
              class="more-filters">
              <ion-select-option value="4">Assign To </ion-select-option>
              <ion-select-option value="1">Branch(es) </ion-select-option>
              <ion-select-option value="2">Management Service Type</ion-select-option>
              <ion-select-option value="3">Status</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>


        <!-- <ion-col size=15>
          <ion-item>
            <ion-label>Port</ion-label>
            <ionic-selectable item-content formControlName="selectedPorts" itemValueField="index" itemTextField="value" [items]="ports" [isMultiple]="true"
             [canClear]="true" [canSearch]="true">
              <ng-template ionicSelectableValueTemplate let-ports="value">
                <div class="ionic-selectable-value-item" *ngFor="let port of ports">
                  {{port.value}}
                </div>
              </ng-template>
            </ionic-selectable>
          </ion-item>
        </ion-col> -->


        <ion-col class="ion-text-right">
          <!-- <ion-button color="success" class="action-btn" fill="outline"
            style="--border-radius: 4px !important;margin-top: 20px;" (click)="applyFilter()">Apply Filters</ion-button> -->
          <ion-button color="danger" class="action-btn" fill="outline"
            style="--border-radius: 4px !important;margin-top: 20px;" (click)="resetFilter()">Reset Filters</ion-button>

        </ion-col>

      </ion-row>

      <ion-row>
        <ion-col size=20 *ngIf="isBranchFilter">
          <ion-item class="select-block">
            <ion-label position="floating">Branch(es)</ion-label>
            <ion-select interface="popover" formControlName="branchfilter" multiple="true" okText="Apply"
              cancelText="Cancel" (ionChange)="onBranchChange()">
              <ion-select-option [value]="office.officeCode" *ngFor="let office of accessibleOffices">
                {{ office.officeName }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <ion-icon name="close-circle" class="close-btn" (click)="closeFilter(1)"> </ion-icon>
        </ion-col>
        <ion-col size=25 *ngIf="isManagementFilter">
          <ion-item class="select-block">
            <ion-label position="floating">Management Service Type</ion-label>
            <ion-select interface="popover" formControlName="managementFilter" multiple="true" okText="Apply"
              cancelText="Cancel" (ionChange)="onMgmtTypeChange()">
              <ion-select-option [value]="type.index" *ngFor="let type of managementType">
                {{ type.description }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <ion-icon name="close-circle" class="close-btn" (click)="closeFilter(2)"> </ion-icon>
        </ion-col>
        <ion-col size=20 *ngIf="isStatusFilter">
          <ion-item class="select-block">
            <ion-label position="floating">Status</ion-label>
            <ion-select formControlName="statusFilter" multiple="true" okText="Apply" cancelText="Cancel"
              (ionChange)="onStatusChange()">
              <ion-select-option [value]="status.index" *ngFor="let status of faultStatuses">
                {{ status.value }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <ion-icon name="close-circle" class="close-btn" (click)="closeFilter(3)"> </ion-icon>
        </ion-col>

        <ion-col size=20 *ngIf="isAssignToFilter">
          <ion-item class="select-block">
            <ion-label position="floating">Assigned To</ion-label>
            <ion-select interface="popover" formControlName="assignToFilter" multiple="true" okText="Apply"
              cancelText="Cancel" (ionChange)="onUserChange()">
              <ion-select-option [value]="user.userId" *ngFor="let user of assignedUsers">
                {{ user.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <ion-icon name="close-circle" class="close-btn" (click)="closeFilter(4)"> </ion-icon>
        </ion-col>

      </ion-row>
    </form>


    <ion-row>
      <ion-col size="100">
        <div class="overlay-container" style="position: relative">
          <table datatable [dtOptions]="dtOptions[0]" class="row-border hover" style="width: 100%; position: relative"
            id="faultListTable">
            <thead>
              <tr>
                <th style="width:20px"></th>
                <th style="width:9%">Issue ID</th>
                <th style="width:10%">Reported On</th>
                <th style="min-width:10%">Category</th>
                <th style="width:15%">Property</th>
                <th style="width:8%">Office</th>
                <th>Job Title</th>
                <th style="width:7%">Reported By</th>
                <th style="width:8%">Fault Status</th>
                <th style="width:30px"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let fault of faultList" class="table-row" (click)="onClickRow(fault)"
                [ngClass]="{'escalated': fault.isEscalated}">
                <td>
                  <ion-fab-button size="small" class="table-fab-btn" *ngIf="fault.urgencyStatus === 3"></ion-fab-button>
                  <ion-fab-button size="small" class="table-fab-btn" *ngIf="fault.urgencyStatus === 2" color="warning"></ion-fab-button>
                  <ion-fab-button size="small" class="table-fab-btn" *ngIf="fault.urgencyStatus === 1" color="danger">
                  </ion-fab-button>
                </td>
                <td>{{fault.reference || '-'}}</td>
                <td>{{fault.createdAt | date: 'dd/MM/yyyy HH:mm:ss' || '-'}}</td>
                <td>
                  {{(fault.sourceType === 'FIXFLO') ? (fault.fixfloCategory || '-') : (getLookupValue(fault.category,
                  faultCategories, 'category') || '-')}}
                </td>
                <!-- <td></td> -->
                <td>{{fault.propertyReference || '-'}} <br>{{fault.propertyAddress.addressLine1}}</td>
                <td>{{getLookupValue(fault.propertyOfficeCode, officeCodes) || '-'}}</td>
                <td>{{fault.title || '-'}}</td>
                <td>{{getLookupValue(fault.reportedBy, reportedByTypes) || '-'}}</td>
                <td>{{getLookupValue(fault.status, faultStatuses) || '-'}}</td>
                <!-- <td>{{getLookupValue(fault.urgencyStatus, faultUrgencyStatuses) || '-'}}</td> -->
                <td class="resp-action-icon">
                  <i (click)="showMenu($event,'divOverlay', fault, 'table-row')"
                    class="propcoicon propcoicon-actions-on action-btn"></i>
                </td>
              </tr>
              <tr *ngIf="faultList?.length == 0">
                <td colspan="11" class="no-data-available">No data!</td>
              </tr>
            </tbody>
          </table>
          <div id="divOverlay">
            <ion-button (click)="notesModal()">Add Note</ion-button>
            <ion-button *ngIf="!selectedData?.isEscalated" (click)="escalateFault()">
              Escalate
            </ion-button>
            <ion-button *ngIf="selectedData?.isEscalated" (click)="deEscalateFault()">
              De-Escalate
            </ion-button>
            <ion-button class="" (click)="goToFaultDetails()">View</ion-button>
            <i (click)="hideMenu($event,'divOverlay')" class="propcoicon propcoicon-actions-on"></i>
          </div>
        </div>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="100">
        <h4>Fault Notes:</h4>
        <div class="overlay-container" style="position: relative">
          <table datatable [dtOptions]="dtOptions[1]" [dtTrigger]="notesDtTrigger" class="row-border hover"
            style="width: 100%; position: relative" #faultNotesTable>
            <thead>
              <tr>
                <th style="width:15%">Date</th>
                <th style="width:15%">Time</th>
                <th style="width:15%">Type</th>
                <th style="width:15%">Complaint</th>
                <th style="width:15%">Category</th>
                <th>User</th>
                <th style="width:40px">Notes</th>
                <!-- <th style="width:5%"></th> -->
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let notes of faultNotes" class="table-row">
                <td>{{notes.postedAt | date: 'dd/MM/yyyy' || '-'}}</td>
                <td>{{notes.postedAt | date: 'HH:mm:ss' || '-'}}</td>
                <td>{{getLookupValue(notes.type, notesTypes) || '-'}}</td>
                <td>{{getLookupValue(notes.complaint, notesComplaints) || '-'}}</td>
                <td>{{getLookupValue(notes.category, notesCategories) || '-'}}</td>
                <td>{{getLookupValue(notes.user, userLookupDetails) || '-'}}</td>
                <td><i (click)="showNoteDescription(notes.notes);"
                    class="propcoicon propcoicon-property-description"></i></td>
                <!-- <td class="resp-action-icon">
                    <i (click)="showMenu($event,'divOverlay', notes, 'table-row')"
                      class="propcoicon propcoicon-actions-on"></i>
                  </td> -->
              </tr>
              <!-- <tr *ngIf="!faultNotes" class="table-row odd">
                  <td colspan="8" class="no-data-available">Please select the fault to view notes!</td>
                </tr> -->
            </tbody>
          </table>
          <div id="divOverlay">
            <!-- <ion-button ng-click="viewApplicant()">view</ion-button> -->
            <i (click)="hideMenu($event,'divOverlay')" class="propcoicon propcoicon-actions-on"></i>
          </div>
        </div>
      </ion-col>
    </ion-row>

  </ion-grid>
</ion-content>
<!-- </div> -->