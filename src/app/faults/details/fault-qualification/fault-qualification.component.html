<ion-grid>
  <ion-row *ngIf="iacNotification">
    <ion-col offset-xl="20" size-xl="60" offset="0" size="100">
      <div class="fault-qualification">
        <div class="banner">
          <ion-row>
            <ion-col width="50" class="ion-text-left">
              <b>{{iacNotification?.templateCode}} {{iacNotification?.firstEmailSentAt | date: 'dd/MM/yyyy hh:mm a'
                }}</b>
            </ion-col>
          </ion-row>
          <h2 class="banner-heading">
            {{iacNotification && iacNotification?.responseReceived ? 'Response Received':'Awaiting response'}}</h2>
          <h6 class="banner-title">Hereâ€™s the action you chose:</h6>
          <ion-button color="success" class="icon-button">
            {{getLookupValue(iacNotification?.faultStageAction, iacStageActions)}}
            <ion-icon name="checkmark-circle-outline"></ion-icon>
          </ion-button>
          <ng-container *ngIf="iacNotification && iacNotification?.responseReceived">
            <h6 class="banner-title response-recived">
              <ion-icon name="ellipse" class="response-circle"></ion-icon> Response received from 
              <span *ngIf="iacNotification?.recipientType === 147">Guarantee Management Company</span> 
              <span *ngIf="iacNotification?.recipientType === 148">Service Contract Company</span>
              <span *ngIf="iacNotification?.recipientType === 146">Block Management Company</span>
              {{iacNotification?.templateCode}} {{iacNotification?.firstEmailSentAt | date: 'dd/MM/yyyy hh:mm a'
              }}
            </h6>
          </ng-container>

          <ng-container *ngIf="iacNotification && !iacNotification?.responseReceived">
            <h6 class="banner-title awaiting-response">
              <ion-icon name="ellipse" class="response-circle"></ion-icon> 
              Awaiting response from the 
              <span *ngIf="iacNotification?.recipientType === 147">Guarantee Management Company</span> 
              <span *ngIf="iacNotification?.recipientType === 148">Service Contract Company</span>
              <span *ngIf="iacNotification?.recipientType === 146">Block Management Company</span>
            </h6>
            <h6 class="banner-title" *ngIf="faultDetails?.status != 18">Next chase due:
              {{iacNotification ? (iacNotification.nextChaseDueAt | date: 'dd MMM yyyy - hh:mm a') : ''}}
            </h6>
          </ng-container>
        </div>
        <div class="question-answer" *ngIf="iacNotification">
          <h6>{{iacNotification?.questions[0]?.qtext}}</h6>
          <ion-grid>
            <ion-row class="ion-justify-content-center">
              <ng-container *ngFor="let data of iacNotification?.questions[0]?.options">
                <ion-button color="success" class="action-btn option"
                  fill="{{data?.value ==  iacNotification?.responseReceived?.isAccepted ? 'solid' :'outline'}}"
                  (click)="questionAction(data)">{{data.text}}</ion-button>
              </ng-container>
            </ion-row>
          </ion-grid>

          <h6 *ngIf="iacNotification && iacNotification?.responseReceived?.isAccepted === false">
            <ion-text color="danger">Please select an appropriate action.</ion-text>
          </h6>
          <div class="border-bottom"></div>
        </div>
        <div class="question-answer"
          *ngIf="iacNotification 
          && (iacNotification?.responseReceived == null) && (iacNotification.allowedNumberOfChases === iacNotification.numberOfChasesDone) && faultDetails.status !== 18 ">
          <h4 claas="ion-text-center">Next Step:</h4>
          <h6>
            <ion-text color="danger">Please note: </ion-text>
            <span>The fault will be <i>escalated</i> automatically if the
              Tenant doesn't respond within {{getPendingHours()}} hours.
            </span>
          </h6>
          <div class="border-bottom"></div>
        </div>

        <div class="question-answer" *ngIf="iacNotification 
          && (iacNotification?.responseReceived?.isAccepted === false || faultDetails.status === 18)">
          <h4 claas="ion-text-center">Next Step:</h4>
          <h6>
            <ion-text color="danger">Please note: </ion-text>Fault Escalated - PM to decide the next steps
          </h6>
          <div class="border-bottom"></div>
        </div>
        <div class="question-answer">
          <h6 class="banner-title">Want to proceed in a different way? Choose one of the following instead:</h6>
          <ion-grid>
            <ion-row class="ion-justify-content-center">
              <ng-container *ngFor="let instruction of otherStageActions">
                <div>
                  <ion-button color="success" expand="block" class="action-btn"
                    fill="{{userSelectedActionControl.value == instruction.index ? 'solid' :'outline'}}"
                    (click)="setUserAction(instruction.index)">
                    {{instruction.value}}
                    <ion-icon name="checkmark-circle-outline" class="check-icon"
                      *ngIf="(userSelectedActionControl.value == instruction.index)"></ion-icon>
                  </ion-button>
                </div>
              </ng-container>
            </ion-row>
          </ion-grid>
        </div>
      </div>
    </ion-col>
  </ion-row>
</ion-grid>
<ion-grid *ngIf="!iacNotification">
  <form [formGroup]="faultQualificationForm">
    <ion-row>
      <ion-col class="card">
        <h3>Management Keys</h3>
        <h5>Does branch hold Management Keys?</h5>
        <ion-row>
          <ion-col size="70">
            <ion-radio-group formControlName="doesBranchHoldKeys">
              <ion-row class="radio-block">
                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="true" slot="start"></ion-radio>
                    <ion-label>Yes</ion-label>
                  </ion-item>
                </ion-col>

                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="false" slot="start"></ion-radio>
                    <ion-label>No</ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-radio-group>
          </ion-col>
          <ion-col size="30">
            <ion-button color="success" class="action-btn popup-view-btn" fill="outline"
              [disabled]="faultQualificationForm.get('doesBranchHoldKeys').value === null || !faultQualificationForm.get('doesBranchHoldKeys').value"
              (click)="viewBranchDetails()">View</ion-button>
          </ion-col>
        </ion-row>
      </ion-col>

      <ion-col class="card">
        <h3>Tenancy Clause</h3>
        <h5>Are there any maintenance specific tenancy clauses?</h5>
        <ion-row>
          <ion-col size="70">
            <ion-radio-group formControlName="hasMaintTenancyClause">
              <ion-row class="radio-block">
                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="true" slot="start"
                      [disabled]="!tenancyClauses"></ion-radio>
                    <ion-label>Yes</ion-label>
                  </ion-item>
                </ion-col>

                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="false" slot="start"
                      [disabled]="!tenancyClauses"></ion-radio>
                    <ion-label>No</ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-radio-group>
          </ion-col>
          <ion-col size="30">
            <ion-button color="success" class="action-btn popup-view-btn" fill="outline"
              [disabled]="faultQualificationForm.get('hasMaintTenancyClause').value === null || !faultQualificationForm.get('hasMaintTenancyClause').value"
              (click)="viewTenancyClause()">View</ion-button>
          </ion-col>
        </ion-row>
        <ion-text color="danger" *ngIf="!tenancyClauses">No details available</ion-text>
      </ion-col>

      <ion-col class="card">
        <h3>Block Management</h3>
        <h5>Is the fault Block Management Company's responsibility? </h5>
        <ion-row>
          <ion-col size="70">
            <ion-radio-group formControlName="isUnderBlockManagement">
              <ion-row class="radio-block">
                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="true" slot="start"></ion-radio>
                    <ion-label>Yes</ion-label>
                  </ion-item>
                </ion-col>

                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="false" slot="start"></ion-radio>
                    <ion-label>No</ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-radio-group>
          </ion-col>
          <ion-col size="30">
            <ion-button color="success" class="action-btn popup-view-btn" fill="outline"
              [disabled]="faultQualificationForm.get('isUnderBlockManagement').value === null || !faultQualificationForm.get('isUnderBlockManagement').value"
              (click)="viewBlockManagement();  $event.stopPropagation();">View</ion-button>
          </ion-col>
        </ion-row>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col class="card">
        <h3>Guarantee / Warranty</h3>
        <h5>Is the fault covered by a Guarantee / Warranty? </h5>
        <ion-row>
          <ion-col size="70">
            <ion-radio-group formControlName="isUnderWarranty">
              <ion-row class="radio-block">
                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="true" slot="start"
                      [disabled]="!certificateCategoriesMap.get(CERTIFICATES_CATEGORY[0])"></ion-radio>
                    <ion-label>Yes</ion-label>
                  </ion-item>
                </ion-col>

                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="false" slot="start"
                      [disabled]="!certificateCategoriesMap.get(CERTIFICATES_CATEGORY[0])"></ion-radio>
                    <ion-label>No</ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-radio-group>
          </ion-col>
          <ion-col size="30">
            <ion-button color="success" class="action-btn popup-view-btn" fill="outline"
              [disabled]="faultQualificationForm.get('isUnderWarranty').value === null || !faultQualificationForm.get('isUnderWarranty').value"
              (click)="viewPropertyCertificate(CERTIFICATES_CATEGORY[0]); $event.stopPropagation();">View</ion-button>
          </ion-col>
        </ion-row>
        <ion-text color="danger" *ngIf="!certificateCategoriesMap.get(CERTIFICATES_CATEGORY[0])">No details available</ion-text>
      </ion-col>
      <ion-col class="card">
        <h3>Service Contract</h3>
        <h5>Is the fault covered by a Service Contract?</h5>
        <ion-row>
          <ion-col size="70">
            <ion-radio-group formControlName="isUnderServiceContract">
              <ion-row class="radio-block">
                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="true" slot="start" [disabled]="!certificateCategoriesMap.get(CERTIFICATES_CATEGORY[1])"></ion-radio>
                    <ion-label>Yes</ion-label>
                  </ion-item>
                </ion-col>

                <ion-col>
                  <ion-item lines="none">
                    <ion-radio mode="md" class="fault-radio-btn" item-left [value]="false" slot="start" [disabled]="!certificateCategoriesMap.get(CERTIFICATES_CATEGORY[1])"></ion-radio>
                    <ion-label>No</ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-radio-group>
            <ion-text color="danger" *ngIf="!certificateCategoriesMap.get(CERTIFICATES_CATEGORY[1])">No details available</ion-text>
          </ion-col>
          <ion-col size="30">
            <ion-button color="success" class="action-btn popup-view-btn" fill="outline"
              [disabled]="faultQualificationForm.get('isUnderServiceContract').value === null || !faultQualificationForm.get('isUnderServiceContract').value"
              (click)="viewPropertyCertificate(CERTIFICATES_CATEGORY[1]); $event.stopPropagation();">View</ion-button>
          </ion-col>
        </ion-row>
      </ion-col>
      <ion-col class="card-extra"></ion-col>
    </ion-row>
  </form>
</ion-grid>

<div class="action-btn-group">
  <ion-button (click)="moreInfo();" class="save-button ion-float-left" [disabled]="faultDetails?.status===10">Request
    More
    Info</ion-button>
  <ion-button (click)="closeFault();" class="cancel-button ion-float-left" [disabled]="faultDetails?.status===10">Close
    Fault
  </ion-button>
  <ion-button (click)="_btnHandler('cancel')" class="cancel-button">Cancel</ion-button>
  <ion-button (click)="_btnHandler('back')">Back</ion-button>
  <ion-button class="save-button" (click)="_btnHandler('save')">Save for later</ion-button>
  <ion-button class="submit-button" (click)="_btnHandler('proceed')" [disabled]="faultDetails?.status===10">Proceed
  </ion-button>
</div>